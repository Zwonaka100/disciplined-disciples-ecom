<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Auth Debug - Disciplined Disciples</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 20px auto; 
            padding: 20px; 
            background: #f0f0f0;
        }
        .log { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            margin: 20px 0; 
            border-left: 4px solid #007bff; 
        }
        .error { border-left-color: #dc3545; background: #fff5f5; }
        .success { border-left-color: #28a745; background: #f0fff4; }
        .warning { border-left-color: #ffc107; background: #fffbf0; }
        button { 
            background: #007bff; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 10px 5px; 
        }
        button:hover { background: #0056b3; }
        input { 
            padding: 10px; 
            margin: 5px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            width: 250px; 
        }
        .code { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 4px; 
            font-family: monospace; 
            white-space: pre-wrap; 
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîç Simple Authentication Debug</h1>
    <p>This page will help us figure out what's going on with the authentication.</p>
    
    <div id="status" class="log">
        <strong>Status:</strong> Starting debug...
    </div>
    
    <div class="log">
        <h3>Quick Actions:</h3>
        <button onclick="checkFirebase()">Check Firebase</button>
        <button onclick="checkAuth()">Check Auth State</button>
        <button onclick="clearStorage()">Clear Storage</button>
        <button onclick="testLogin()">Test Login</button>
        <button onclick="goToProfile()">Go to Profile</button>
        <button onclick="goToLogin()">Go to Login</button>
    </div>
    
    <div class="log">
        <h3>Test Login:</h3>
        <input type="email" id="email" placeholder="Email" value="">
        <input type="password" id="password" placeholder="Password" value="">
        <button onclick="attemptLogin()">Login</button>
        <button onclick="attemptSignup()">Signup</button>
    </div>
    
    <div id="console" class="log">
        <h3>Console Output:</h3>
        <div id="console-output" class="code">Ready...\n</div>
    </div>
    
    <!-- Load Firebase and your script -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="script.js"></script>
    
    <script>
        // Override console.log to show in our debug area
        const originalLog = console.log;
        const originalError = console.error;
        const consoleOutput = document.getElementById('console-output');
        
        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'warn' ? '‚ö†Ô∏è' : 'üìù';
            consoleOutput.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };
        
        // Update status
        function updateStatus(message, type = 'log') {
            const status = document.getElementById('status');
            status.className = `log ${type}`;
            status.innerHTML = `<strong>Status:</strong> ${message}`;
        }
        
        // Check Firebase
        function checkFirebase() {
            console.log('Checking Firebase...');
            
            if (typeof firebase === 'undefined') {
                updateStatus('‚ùå Firebase SDK not loaded', 'error');
                return false;
            }
            
            if (!firebase.apps.length) {
                updateStatus('‚ùå Firebase not initialized', 'error');
                return false;
            }
            
            if (!firebase.auth) {
                updateStatus('‚ùå Firebase Auth not available', 'error');
                return false;
            }
            
            updateStatus('‚úÖ Firebase is working properly', 'success');
            console.log('Firebase app:', firebase.apps[0].options.projectId);
            return true;
        }
        
        // Check auth state
        function checkAuth() {
            console.log('Checking authentication state...');
            
            if (!checkFirebase()) return;
            
            const currentUser = firebase.auth().currentUser;
            
            if (currentUser) {
                updateStatus(`‚úÖ User is logged in: ${currentUser.email}`, 'success');
                console.log('User UID:', currentUser.uid);
                console.log('Email verified:', currentUser.emailVerified);
            } else {
                updateStatus('‚ÑπÔ∏è No user is currently logged in', 'warning');
                
                // Check storage
                const localAuth = Object.keys(localStorage).filter(k => k.includes('firebase'));
                const sessionAuth = Object.keys(sessionStorage).filter(k => k.includes('firebase'));
                
                if (localAuth.length > 0 || sessionAuth.length > 0) {
                    console.log('Found auth data in storage but no current user');
                    console.log('Local keys:', localAuth);
                    console.log('Session keys:', sessionAuth);
                }
            }
        }
        
        // Clear storage
        function clearStorage() {
            console.log('Clearing all storage...');
            localStorage.clear();
            sessionStorage.clear();
            
            if (firebase && firebase.auth) {
                firebase.auth().signOut();
            }
            
            updateStatus('‚úÖ Storage cleared', 'success');
        }
        
        // Test login with Firebase Auth
        async function attemptLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                updateStatus('‚ö†Ô∏è Please enter email and password', 'warning');
                return;
            }
            
            console.log('Attempting login with:', email);
            
            try {
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                updateStatus(`‚úÖ Login successful: ${user.email}`, 'success');
                console.log('Login successful, UID:', user.uid);
                
                setTimeout(checkAuth, 1000);
                
            } catch (error) {
                updateStatus(`‚ùå Login failed: ${error.message}`, 'error');
                console.error('Login error:', error.code, error.message);
            }
        }
        
        // Test signup
        async function attemptSignup() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                updateStatus('‚ö†Ô∏è Please enter email and password', 'warning');
                return;
            }
            
            console.log('Attempting signup with:', email);
            
            try {
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                updateStatus(`‚úÖ Signup successful: ${user.email}`, 'success');
                console.log('Signup successful, UID:', user.uid);
                
                setTimeout(checkAuth, 1000);
                
            } catch (error) {
                updateStatus(`‚ùå Signup failed: ${error.message}`, 'error');
                console.error('Signup error:', error.code, error.message);
            }
        }
        
        // Test login function
        function testLogin() {
            console.log('Testing login function from script.js...');
            
            if (typeof window.testLogin === 'function') {
                window.testLogin();
            } else {
                console.log('testLogin function not found in script.js');
            }
        }
        
        // Navigate to profile
        function goToProfile() {
            console.log('Navigating to profile page...');
            window.location.href = 'profile.html';
        }
        
        // Navigate to login
        function goToLogin() {
            console.log('Navigating to login page...');
            window.location.href = 'login-signup.html';
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Debug page loaded');
            updateStatus('Debug page ready', 'success');
            
            // Auto-check Firebase after a short delay
            setTimeout(() => {
                checkFirebase();
                checkAuth();
                
                // Set up auth state listener
                if (firebase && firebase.auth) {
                    firebase.auth().onAuthStateChanged((user) => {
                        console.log('Auth state changed:', user ? user.email : 'No user');
                    });
                }
            }, 1000);
        });
    </script>
</body>
</html>