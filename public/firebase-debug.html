<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Debug Tool - Disciplined Disciples</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 1000px; 
            margin: 20px auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .card { 
            background: white; 
            border-radius: 12px; 
            padding: 24px; 
            margin: 20px 0; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #007bff;
        }
        .header { 
            text-align: center; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 40px; 
            border-radius: 12px; 
            margin-bottom: 30px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        .status { 
            padding: 16px; 
            margin: 12px 0; 
            border-radius: 8px; 
            font-weight: 500;
        }
        .success { background: #d4edda; border: 2px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 2px solid #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border: 2px solid #ffeaa7; color: #856404; }
        .info { background: #d1ecf1; border: 2px solid #bee5eb; color: #0c5460; }
        .loading { background: #e2e3e5; border: 2px solid #d6d8db; color: #383d41; }
        
        button { 
            background: #007bff; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 6px; 
            font-size: 14px;
            transition: all 0.2s;
        }
        button:hover { background: #0056b3; transform: translateY(-1px); }
        .btn-danger { background: #dc3545; } 
        .btn-danger:hover { background: #c82333; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        
        input { 
            padding: 12px; 
            margin: 8px; 
            border: 2px solid #ddd; 
            border-radius: 6px; 
            width: 280px; 
            font-size: 14px;
            transition: border-color 0.2s;
        }
        input:focus { outline: none; border-color: #007bff; }
        
        .code { 
            background: #f8f9fa; 
            padding: 16px; 
            border-radius: 6px; 
            font-family: 'Courier New', monospace; 
            margin: 12px 0; 
            border-left: 4px solid #007bff; 
            font-size: 13px;
            overflow-x: auto;
        }
        
        h2 { 
            color: #333; 
            border-bottom: 2px solid #eee; 
            padding-bottom: 12px; 
            margin-top: 0;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .diagnostic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üî• Firebase Authentication Diagnostic Tool</h1>
        <p>Complete Firebase configuration analysis and redirect loop diagnosis</p>
        <p><strong>Project:</strong> disciplined-disciples-1</p>
    </div>
    
    <div class="card">
        <h2>üîß Firebase Initialization Check</h2>
        <div id="init-status">
            <div class="loading">
                <span class="spinner"></span> Testing Firebase initialization...
            </div>
        </div>
    </div>

    <div class="card">
        <h2>üîê Authentication State Analysis</h2>
        <div id="auth-status">
            <div class="loading">
                <span class="spinner"></span> Analyzing authentication state...
            </div>
        </div>
        <div style="margin-top: 16px;">
            <button onclick="checkAuthState()">üîÑ Refresh Auth State</button>
            <button onclick="clearAuthData()" class="btn-danger">üóëÔ∏è Clear Auth Data</button>
            <button onclick="checkLocalStorage()">üíæ Check Storage</button>
        </div>
    </div>

    <div class="card">
        <h2>üóÑÔ∏è Firestore Database Test</h2>
        <div id="db-status">
            <div class="loading">
                <span class="spinner"></span> Testing Firestore connection...
            </div>
        </div>
        <div style="margin-top: 16px;">
            <button onclick="testFirestore()">üîÑ Test Connection</button>
            <button onclick="testFirestoreWrite()">‚úèÔ∏è Test Write</button>
            <button onclick="testUserDocument()">üë§ Test User Doc</button>
        </div>
    </div>

    <div class="card">
        <h2>üß™ Authentication Testing</h2>
        <div style="margin-bottom: 16px;">
            <div>
                <input type="email" id="test-email" placeholder="Test email address" value="">
            </div>
            <div>
                <input type="password" id="test-password" placeholder="Test password" value="">
            </div>
            <div style="margin-top: 16px;">
                <button onclick="testLogin()" class="btn-success">üîë Test Login</button>
                <button onclick="testSignup()">üìù Test Signup</button>
                <button onclick="testLogout()" class="btn-danger">üö™ Logout</button>
            </div>
        </div>
        <div id="login-status"></div>
    </div>

    <div class="card">
        <h2>üîÑ Redirect Loop Diagnosis</h2>
        <div id="redirect-diagnosis">
            <div class="loading">
                <span class="spinner"></span> Analyzing redirect behavior...
            </div>
        </div>
        <div style="margin-top: 16px;">
            <button onclick="diagnoseRedirectLoop()">üîç Diagnose Redirect Loop</button>
            <button onclick="simulateProfileAccess()">üß™ Simulate Profile Access</button>
            <button onclick="simulateLoginFlow()">üß™ Simulate Login Flow</button>
        </div>
    </div>

    <div class="diagnostic-grid">
        <div class="card">
            <h2>üìä System Information</h2>
            <div id="system-info"></div>
        </div>
        
        <div class="card">
            <h2>üîß Quick Fix Actions</h2>
            <div>
                <button onclick="fixAuthPersistence()" class="btn-success">üîß Fix Auth Persistence</button>
                <button onclick="resetFirebaseState()" class="btn-danger">üîÑ Reset Firebase State</button>
                <button onclick="testAuthTiming()">‚è±Ô∏è Test Auth Timing</button>
            </div>
            <div id="fix-status"></div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        let authStateReady = false;
        let authStateListener = null;
        let diagnosticResults = {};
        
        // Initialize diagnostic tool
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üî• Firebase Diagnostic Tool Loading...');
            
            // Wait for script.js to initialize Firebase
            setTimeout(() => {
                runFullDiagnostic();
            }, 1500);
        });
        
        // Run complete diagnostic
        async function runFullDiagnostic() {
            console.log('üî• Running Full Diagnostic...');
            
            // Test all components
            const initResult = testInitialization();
            await checkAuthState();
            await testFirestore();
            showSystemInfo();
            diagnoseRedirectLoop();
            
            // Set up real-time auth monitoring
            setupAuthMonitoring();
        }
        
        // Test Firebase initialization
        function testInitialization() {
            const initStatus = document.getElementById('init-status');
            let results = [];
            
            try {
                // Check Firebase SDK
                if (typeof firebase === 'undefined') {
                    results.push('‚ùå Firebase SDK not loaded');
                    initStatus.innerHTML = `<div class="error">${results.join('<br>')}</div>`;
                    return false;
                }
                results.push('‚úÖ Firebase SDK loaded');
                
                // Check Firebase app
                if (!firebase.apps.length) {
                    results.push('‚ùå Firebase app not initialized');
                    initStatus.innerHTML = `<div class="error">${results.join('<br>')}</div>`;
                    return false;
                }
                results.push('‚úÖ Firebase app initialized');
                
                // Check Auth
                if (!firebase.auth) {
                    results.push('‚ùå Firebase Auth not available');
                } else {
                    results.push('‚úÖ Firebase Auth available');
                }
                
                // Check Firestore
                if (!firebase.firestore) {
                    results.push('‚ùå Firebase Firestore not available');
                } else {
                    results.push('‚úÖ Firebase Firestore available');
                }
                
                // Check current project
                const app = firebase.apps[0];
                if (app && app.options) {
                    results.push(`‚úÖ Project ID: ${app.options.projectId}`);
                    results.push(`‚úÖ Auth Domain: ${app.options.authDomain}`);
                }
                
                diagnosticResults.initialization = true;
                initStatus.innerHTML = `<div class="success">${results.join('<br>')}</div>`;
                return true;
                
            } catch (error) {
                results.push(`‚ùå Initialization error: ${error.message}`);
                initStatus.innerHTML = `<div class="error">${results.join('<br>')}</div>`;
                diagnosticResults.initialization = false;
                return false;
            }
        }
        
        // Enhanced auth state check
        async function checkAuthState() {
            const authStatus = document.getElementById('auth-status');
            
            try {
                const currentUser = firebase.auth().currentUser;
                let results = [];
                
                if (currentUser) {
                    results.push('‚úÖ User is authenticated');
                    results.push(`<strong>UID:</strong> ${currentUser.uid}`);
                    results.push(`<strong>Email:</strong> ${currentUser.email}`);
                    results.push(`<strong>Email Verified:</strong> ${currentUser.emailVerified}`);
                    results.push(`<strong>Provider:</strong> ${currentUser.providerData.map(p => p.providerId).join(', ')}`);
                    results.push(`<strong>Last Sign In:</strong> ${currentUser.metadata.lastSignInTime}`);
                    
                    // Test token
                    try {
                        const token = await currentUser.getIdToken();
                        results.push('‚úÖ Auth token valid');
                    } catch (tokenError) {
                        results.push(`‚ùå Auth token error: ${tokenError.message}`);
                    }
                    
                    diagnosticResults.authState = 'authenticated';
                    authStatus.innerHTML = `<div class="success">${results.join('<br>')}</div>`;
                    
                } else {
                    results.push('‚ÑπÔ∏è No user currently authenticated');
                    
                    // Check stored auth data
                    const localAuth = localStorage.getItem('firebase:authUser:AIzaSyBVpuDI_YJI7mxtT6-igSL7ZX3s-cqMRnc:[DEFAULT]');
                    const sessionAuth = sessionStorage.getItem('firebase:authUser:AIzaSyBVpuDI_YJI7mxtT6-igSL7ZX3s-cqMRnc:[DEFAULT]');
                    
                    if (localAuth) {
                        results.push('‚ö†Ô∏è Auth data found in localStorage but not active');
                    }
                    if (sessionAuth) {
                        results.push('‚ö†Ô∏è Auth data found in sessionStorage but not active');
                    }
                    
                    diagnosticResults.authState = 'unauthenticated';
                    authStatus.innerHTML = `<div class="info">${results.join('<br>')}</div>`;
                }
                
            } catch (error) {
                const errorMsg = `‚ùå Auth state check failed: ${error.message}`;
                authStatus.innerHTML = `<div class="error">${errorMsg}</div>`;
                diagnosticResults.authState = 'error';
            }
        }
        
        // Test Firestore
        async function testFirestore() {
            const dbStatus = document.getElementById('db-status');
            
            try {
                dbStatus.innerHTML = '<div class="loading"><span class="spinner"></span> Testing Firestore...</div>';
                
                const db = firebase.firestore();
                let results = [];
                
                // Test basic connection
                const testDoc = await db.collection('test').doc('connectivity').get();
                results.push('‚úÖ Firestore connection successful');
                
                // Test read from artifacts collection
                try {
                    const artifactsTest = await db.collection('artifacts').doc('default-app-id').get();
                    if (artifactsTest.exists) {
                        results.push('‚úÖ Artifacts collection accessible');
                    } else {
                        results.push('‚ÑπÔ∏è Artifacts document does not exist (normal)');
                    }
                } catch (artifactsError) {
                    results.push(`‚ö†Ô∏è Artifacts access: ${artifactsError.message}`);
                }
                
                diagnosticResults.firestore = true;
                dbStatus.innerHTML = `<div class="success">${results.join('<br>')}</div>`;
                
            } catch (error) {
                console.error('Firestore test error:', error);
                const errorMsg = `‚ùå Firestore error: ${error.message}<br>Code: ${error.code}`;
                dbStatus.innerHTML = `<div class="error">${errorMsg}</div>`;
                diagnosticResults.firestore = false;
            }
        }
        
        // Test user document access
        async function testUserDocument() {
            const currentUser = firebase.auth().currentUser;
            if (!currentUser) {
                document.getElementById('db-status').innerHTML = '<div class="warning">‚ö†Ô∏è Login first to test user document access</div>';
                return;
            }
            
            try {
                const db = firebase.firestore();
                const userDoc = await db.collection('artifacts/default-app-id/users').doc(currentUser.uid).get();
                
                let message = '';
                if (userDoc.exists) {
                    message = `‚úÖ User document exists<br>Data: ${JSON.stringify(userDoc.data(), null, 2)}`;
                } else {
                    message = '‚ÑπÔ∏è User document does not exist (will be created on profile update)';
                }
                
                document.getElementById('db-status').innerHTML = `<div class="success">${message}</div>`;
                
            } catch (error) {
                document.getElementById('db-status').innerHTML = `<div class="error">‚ùå User document test failed: ${error.message}</div>`;
            }
        }
        
        // Diagnose redirect loop
        function diagnoseRedirectLoop() {
            const diagnosis = document.getElementById('redirect-diagnosis');
            
            const currentUser = firebase.auth().currentUser;
            const currentPage = window.location.pathname;
            let results = [];
            
            // Analyze current state
            results.push(`<strong>Current Page:</strong> ${currentPage}`);
            results.push(`<strong>Auth State:</strong> ${currentUser ? 'Authenticated' : 'Not Authenticated'}`);
            
            // Simulate profile access logic
            if (currentPage.includes('profile')) {
                if (!currentUser) {
                    results.push('üîÑ Profile page + No user = Would redirect to login');
                } else {
                    results.push('‚úÖ Profile page + User exists = Would load profile');
                }
            } else if (currentPage.includes('login')) {
                if (currentUser) {
                    results.push('üîÑ Login page + User exists = Would redirect to profile');
                } else {
                    results.push('‚úÖ Login page + No user = Would show login form');
                }
            }
            
            // Check for timing issues
            if (firebase.auth().currentUser === null && authStateReady === false) {
                results.push('‚ö†Ô∏è Auth state may not be ready - potential timing issue');
            }
            
            // Redirect loop risk assessment
            if (currentUser && (currentPage.includes('login') || currentPage.includes('auth-test'))) {
                results.push('üö® REDIRECT LOOP RISK: User is logged in but on login-related page');
                results.push('üí° SOLUTION: Add proper auth state waiting before redirect decisions');
            }
            
            diagnosis.innerHTML = `<div class="info">${results.join('<br>')}</div>`;
        }
        
        // Setup auth monitoring
        function setupAuthMonitoring() {
            if (authStateListener) {
                authStateListener(); // Remove previous listener
            }
            
            authStateListener = firebase.auth().onAuthStateChanged((user) => {
                console.log('üî• Auth State Changed:', user ? `${user.email} (${user.uid})` : 'No user');
                authStateReady = true;
                
                // Update all relevant displays
                setTimeout(() => {
                    checkAuthState();
                    diagnoseRedirectLoop();
                }, 100);
            });
        }
        
        // Show system information
        function showSystemInfo() {
            const systemInfo = document.getElementById('system-info');
            
            const info = `
                <div class="code">
                    <strong>Browser:</strong> ${navigator.userAgent.split(' ').slice(-2).join(' ')}<br>
                    <strong>URL:</strong> ${window.location.href}<br>
                    <strong>Timestamp:</strong> ${new Date().toISOString()}<br>
                    <strong>Firebase SDK:</strong> ${firebase.SDK_VERSION || 'Unknown'}<br>
                    <strong>Local Storage:</strong> ${Object.keys(localStorage).filter(k => k.includes('firebase')).length} Firebase keys<br>
                    <strong>Session Storage:</strong> ${Object.keys(sessionStorage).filter(k => k.includes('firebase')).length} Firebase keys<br>
                    <strong>Auth Ready:</strong> ${authStateReady ? 'Yes' : 'No'}
                </div>
            `;
            
            systemInfo.innerHTML = info;
        }
        
        // Fix auth persistence
        async function fixAuthPersistence() {
            const fixStatus = document.getElementById('fix-status');
            
            try {
                await firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);
                fixStatus.innerHTML = '<div class="success">‚úÖ Auth persistence set to LOCAL</div>';
            } catch (error) {
                fixStatus.innerHTML = `<div class="error">‚ùå Failed to set persistence: ${error.message}</div>`;
            }
        }
        
        // Reset Firebase state
        function resetFirebaseState() {
            localStorage.clear();
            sessionStorage.clear();
            firebase.auth().signOut();
            
            document.getElementById('fix-status').innerHTML = '<div class="success">‚úÖ Firebase state reset - refresh page to test</div>';
        }
        
        // Test auth timing
        function testAuthTiming() {
            const fixStatus = document.getElementById('fix-status');
            
            let timingResults = [];
            const startTime = Date.now();
            
            // Check immediate auth state
            const immediateUser = firebase.auth().currentUser;
            timingResults.push(`T+0ms: currentUser = ${immediateUser ? 'Present' : 'null'}`);
            
            // Check after short delays
            setTimeout(() => {
                const user100 = firebase.auth().currentUser;
                timingResults.push(`T+100ms: currentUser = ${user100 ? 'Present' : 'null'}`);
            }, 100);
            
            setTimeout(() => {
                const user500 = firebase.auth().currentUser;
                timingResults.push(`T+500ms: currentUser = ${user500 ? 'Present' : 'null'}`);
                
                fixStatus.innerHTML = `<div class="code">${timingResults.join('<br>')}</div>`;
            }, 500);
        }
        
        // Check local storage
        function checkLocalStorage() {
            const authStatus = document.getElementById('auth-status');
            
            const firebaseKeys = Object.keys(localStorage).filter(k => k.includes('firebase'));
            const sessionKeys = Object.keys(sessionStorage).filter(k => k.includes('firebase'));
            
            let results = [];
            
            results.push('<strong>Local Storage Firebase Keys:</strong>');
            if (firebaseKeys.length === 0) {
                results.push('None found');
            } else {
                firebaseKeys.forEach(key => {
                    const value = localStorage.getItem(key);
                    results.push(`${key}: ${value ? 'Present' : 'Empty'}`);
                });
            }
            
            results.push('<br><strong>Session Storage Firebase Keys:</strong>');
            if (sessionKeys.length === 0) {
                results.push('None found');
            } else {
                sessionKeys.forEach(key => {
                    const value = sessionStorage.getItem(key);
                    results.push(`${key}: ${value ? 'Present' : 'Empty'}`);
                });
            }
            
            authStatus.innerHTML = `<div class="info">${results.join('<br>')}</div>`;
        }
        
        // Clear auth data
        function clearAuthData() {
            const firebaseKeys = Object.keys(localStorage).filter(k => k.includes('firebase'));
            const sessionKeys = Object.keys(sessionStorage).filter(k => k.includes('firebase'));
            
            firebaseKeys.forEach(key => localStorage.removeItem(key));
            sessionKeys.forEach(key => sessionStorage.removeItem(key));
            
            firebase.auth().signOut();
            
            setTimeout(() => {
                checkAuthState();
                document.getElementById('fix-status').innerHTML = '<div class="success">‚úÖ Auth data cleared</div>';
            }, 500);
        }
        
        // Test login
        async function testLogin() {
            const loginStatus = document.getElementById('login-status');
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;
            
            if (!email || !password) {
                loginStatus.innerHTML = '<div class="warning">‚ö†Ô∏è Please enter both email and password</div>';
                return;
            }
            
            try {
                loginStatus.innerHTML = '<div class="loading"><span class="spinner"></span> Attempting login...</div>';
                
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                loginStatus.innerHTML = `
                    <div class="success">
                        ‚úÖ Login successful<br>
                        <strong>UID:</strong> ${user.uid}<br>
                        <strong>Email:</strong> ${user.email}<br>
                        <strong>Time:</strong> ${new Date().toLocaleString()}
                    </div>
                `;
                
                setTimeout(() => {
                    checkAuthState();
                    diagnoseRedirectLoop();
                }, 1000);
                
            } catch (error) {
                console.error('Login error:', error);
                loginStatus.innerHTML = `<div class="error">‚ùå Login failed: ${error.message}<br>Code: ${error.code}</div>`;
            }
        }
        
        // Test signup
        async function testSignup() {
            const loginStatus = document.getElementById('login-status');
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;
            
            if (!email || !password) {
                loginStatus.innerHTML = '<div class="warning">‚ö†Ô∏è Please enter both email and password</div>';
                return;
            }
            
            try {
                loginStatus.innerHTML = '<div class="loading"><span class="spinner"></span> Creating account...</div>';
                
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                loginStatus.innerHTML = `
                    <div class="success">
                        ‚úÖ Account created successfully<br>
                        <strong>UID:</strong> ${user.uid}<br>
                        <strong>Email:</strong> ${user.email}
                    </div>
                `;
                
                setTimeout(() => {
                    checkAuthState();
                    diagnoseRedirectLoop();
                }, 1000);
                
            } catch (error) {
                console.error('Signup error:', error);
                loginStatus.innerHTML = `<div class="error">‚ùå Signup failed: ${error.message}<br>Code: ${error.code}</div>`;
            }
        }
        
        // Test logout
        async function testLogout() {
            const loginStatus = document.getElementById('login-status');
            
            try {
                await firebase.auth().signOut();
                loginStatus.innerHTML = '<div class="success">‚úÖ Logout successful</div>';
                
                setTimeout(() => {
                    checkAuthState();
                    diagnoseRedirectLoop();
                }, 500);
            } catch (error) {
                console.error('Logout error:', error);
                loginStatus.innerHTML = `<div class="error">‚ùå Logout failed: ${error.message}</div>`;
            }
        }
        
        // Test Firestore write
        async function testFirestoreWrite() {
            const dbStatus = document.getElementById('db-status');
            
            try {
                const db = firebase.firestore();
                const testData = {
                    timestamp: new Date(),
                    test: true,
                    userAgent: navigator.userAgent,
                    url: window.location.href
                };
                
                await db.collection('test').doc('diagnostic').set(testData);
                dbStatus.innerHTML = '<div class="success">‚úÖ Firestore write test successful</div>';
                
            } catch (error) {
                console.error('Firestore write error:', error);
                dbStatus.innerHTML = `<div class="error">‚ùå Write failed: ${error.message}</div>`;
            }
        }
        
        // Simulate profile access
        function simulateProfileAccess() {
            const currentUser = firebase.auth().currentUser;
            const diagnosis = document.getElementById('redirect-diagnosis');
            
            if (!currentUser) {
                diagnosis.innerHTML = `
                    <div class="warning">
                        ‚ö†Ô∏è Profile Access Simulation<br>
                        <strong>Result:</strong> Would redirect to login (no authenticated user)<br>
                        <strong>Expected Behavior:</strong> This is correct for unauthenticated users<br>
                        <strong>Code Flow:</strong> profile.html ‚Üí firebase.auth().currentUser === null ‚Üí redirect to login-signup.html
                    </div>
                `;
            } else {
                diagnosis.innerHTML = `
                    <div class="success">
                        ‚úÖ Profile Access Simulation<br>
                        <strong>Result:</strong> Would load profile successfully<br>
                        <strong>User:</strong> ${currentUser.email}<br>
                        <strong>Expected Behavior:</strong> Profile should load normally<br>
                        <strong>Code Flow:</strong> profile.html ‚Üí firebase.auth().currentUser exists ‚Üí load profile data
                    </div>
                `;
            }
        }
        
        // Simulate login flow
        function simulateLoginFlow() {
            const currentUser = firebase.auth().currentUser;
            const diagnosis = document.getElementById('redirect-diagnosis');
            
            if (currentUser) {
                diagnosis.innerHTML = `
                    <div class="error">
                        üö® Login Flow Simulation<br>
                        <strong>Result:</strong> Would redirect to profile (user already authenticated)<br>
                        <strong>User:</strong> ${currentUser.email}<br>
                        <strong>REDIRECT LOOP RISK:</strong> If profile page auth check fails due to timing issues<br>
                        <strong>Solution:</strong> Implement proper auth state waiting mechanism
                    </div>
                `;
            } else {
                diagnosis.innerHTML = `
                    <div class="success">
                        ‚úÖ Login Flow Simulation<br>
                        <strong>Result:</strong> Would show login form<br>
                        <strong>Expected Behavior:</strong> User can enter credentials<br>
                        <strong>Code Flow:</strong> login-signup.html ‚Üí no user ‚Üí show login form
                    </div>
                `;
            }
        }
    </script>
</body>
</html>